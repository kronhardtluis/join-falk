<div class="contact-site" [class.mobile-details-open]="isVisible()">
  <div class="main-contacts-list">
    <button (click)="openDialogWindow('addContact')" class="add-contact-btn">
      Add new contact
    </button>

    @if (dbService.contacts().length > 0) {
    <div class="list">
      @for (contact of dbService.contacts(); track contact.id; let i = $index){
      <div>
        <div>
          @let currentLetter = contact.name[0].toUpperCase();
          @let previousContact = dbService.contacts()[i - 1];
          @if (i === 0 || currentLetter !== previousContact.name[0].toUpperCase()) {
            <div>
              <h2 class="letter">{{ currentLetter }}</h2>
              <div class="line-contacts"></div>
            </div>
          }
        </div>
        <div
          class="simple-info"
          (click)="contact.id !== undefined && openDetailWindow(contact.id)"
          [class.active]="selectedContactId() === contact.id">
          <span class="roundContact" [style.background-color]="contact.color">
            {{ contact.name[0].toUpperCase() }}{{ getSecondInitial(contact.name) }}
          </span>
          <div>
            <span>{{ contact.name }}</span><br />
            <span class="email">
              <a href="mailto:{{ contact.email }}">{{ contact.email }}</a>
            </span>
          </div>
        </div>
      </div>
      }
    </div>
    }
    <div class="mobile-add-contact-btn-div">
      <button (click)="openDialogWindow('addContact')" class="add-contact-btn-mobile"></button>
    </div>
  </div>

  <div class="main-contact-info">
    <div class="contact-header">
      <p class="contact-header__title">Contacts <button class="mobile-back-btn" (click)="closeDetailView(true)"></button></p>
      <div class="contact-header__separator"></div>
      <p class="contact-header__description">Better with a team</p>
    </div>
    <div class="contact-description" [class.active-view]="isVisible()">
      @if (selectedContactData(); as contact) {
      <div class="header-details">
        <div class="roundContact-large" [style.background-color]="contact.color">
          {{ contact.name[0].toUpperCase() }}{{ getSecondInitial(contact.name) }}
        </div>

        <div class="name-container">
          <h3>{{ contact.name }}</h3>
          <div class="action-buttons">
            <button class="btn-edit" (click)="openDialogWindow('editContact', contact.id)">
              Edit
            </button>
            <button class="btn-delete" (click)="openDialogWindow('deleteContact', contact.id)">
              Delete
            </button>
          </div>
        </div>
      </div>
      <h4>Contact Information</h4>
      <h5 class="label">Email</h5>
      <p>
        <a href="mailto:{{ contact.email }}">{{ contact.email }}</a>
      </p>
      <h5 class="label">Phone</h5>
      <p class="value">{{ contact.phone || 'No phone number' }}</p>
      }
    </div>
    <div class="mobile-menu-btn-div">
      @if (!isMobileMenuOpen()) {
        <button (click)="toggleMobileMenu($event)" class="mobile-menu-btn"></button>
      }
      @if (isMobileMenuOpen()) {
        <div class="mobile-options-menu" (click)="$event.stopPropagation()">
          <button (click)="handleMobileAction('editContact')" class="btn-edit-mobile">Edit</button>
          <button (click)="handleMobileAction('deleteContact')" class="btn-delete-mobile">Delete</button>
        </div>
      }
    </div>
  </div>

  <dialog #contactDialog (click)="onBackdropClick($event)">
    <div (click)="$event.stopPropagation()">
      <button id="close" (click) = "closeDialog()"></button>
      <section id="left-section">
        <img id="logo" src="assets/icons/logo-light.png" alt="Logo" />
        <h3>{{ isEditMode() ? 'Edit contact' : 'Add contact' }}</h3>
        @if(!isEditMode()){
          <p>Tasks are better with a team</p>
        }
        <img src="assets/icons/blue-underline.png" alt="Underline" />
      </section>

      <section id="right-section">
        <div id="user">
          @if(isEditMode() && selectedContactData(); as contact){
            <div class="roundContact-large" [style.background-color]="selectedContactData()?.color">
              {{ contact.name[0].toUpperCase() }}{{ getSecondInitial(contact.name) }}
            </div>
          } @else {
            <img src="assets/icons/unknown-user.png" alt="User" />
          }
        </div>
        <div id="form-container">
          <form [formGroup]="userForm" (ngSubmit)="formSubmit()">
            <div class="input-icons">
              <img class="icon" src="assets/icons/person.png" alt="User" />
              <input id="name" formControlName="name" type="text" placeholder="Name" />
              @if (userForm.get('name')?.hasError('required') && userForm.get('name')?.touched) {
                <span class="error-msg">This field is required.</span>
              }
              @if (userForm.get('name')?.hasError('minLength') || userForm.get('name')?.hasError('pattern')) {
                <span class="error-msg">Please enter data in the following format: Name Surname</span>
              }
            </div>
            <div class="input-icons">
              <img class="icon" src="assets/icons/mail.png" alt="Mail" />
              <input id="mail" formControlName="email" type="text" placeholder="E-Mail" />
              @if (userForm.get('email')?.hasError('required') && userForm.get('email')?.touched) {
                <span class="error-msg">This field is required.</span>
              }
              @if (userForm.get('email')?.hasError('email')) {
                <span class="error-msg">Please enter a valid email address.</span>
              }
            </div>
            <div class="input-icons">
              <img class="icon" src="assets/icons/phone.png" alt="Phone" />
              <input id="phone" formControlName="phone" type="text" placeholder="Phone" />
              @if (userForm.get('phone')?.hasError('required') && userForm.get('phone')?.touched) {
                <span class="error-msg">This field is required.</span>
              }
              @if(userForm.get('phone')?.hasError('pattern')){
                <span class="error-msg">Please enter a valid phone number.</span>
              }
            </div>
            <div id="dialog-buttons">
              @if(isEditMode()){
                <button id="delete" (click)="openDialogWindow('deleteContact')">Delete</button>
                <button id="save" (click)="formSubmit()" [disabled]="userForm.invalid">Save</button>
              } @else {
                <button id="cancel" (click)="closeDialog()">Cancel</button>
                <button id="create-contact" (click)="formSubmit()" [disabled]="userForm.invalid">Create</button>
              }
            </div>
          </form>
        </div>
      </section>
    </div>
  </dialog>

  <div id="notification" [class.show]="notificationMessage()">
    <span>{{ notificationMessage() }}</span>
  </div>

</div>
